# 食用说明
本项目是一个基于NcatBot/NapCat的类茨菇QQ机器人。<br>
目前支持功能: `Bang Dream` | `YGO群赛` | `BiliBili视频获取`

# Bang Dream
Bang Dream, 以下简称邦邦。<br>
目前邦邦查谱类功能为此机器人主要功能。主要目的是快速查询自制谱及官谱谱面图片及基础信息。<br>
主要信息来源为Bestdori API。<br>
对比茨菇，本项目具有以下特点:<br>
1. 融合查曲与查谱功能，减少用户查谱步骤
2. 文字输出，目的是方便用户复制细项
3. 支持自制谱查询

本项目目的并非取代茨菇，而是对茨菇功能上的补全优化，以及为邦友们提供更多机器人选择。事实上，介于文字输出的特点以及开发者个人能力，本项目在使用及功能开发上限制比茨菇等通用机器人多上不少，只能算低配。个人亦建議在群里结合茨菇同时使用。

## 查谱
查谱功能支持快速向Bestdori查询自制谱及官谱谱面信息。具体信息及指令如下:

### 自制谱
指令: 自制 `ID` `带音乐`<br>

    种类一
    `ID` 为必填参数。通常为6位纯数字ID。程序将利用用户输入的贴文ID向Bestdori Api查询相关Post信息。
    `带音乐` 为可选参数。程序将检查指令尾部是否带有`带音乐`字样。如有，程序将在发送谱面信息至群内之后以`文件`追加发送该谱面的`音频文件`。
    使用例: 自制 114514 带音乐
    使用例: 自制 114514

信息将包括: `谱面名称` `谱面ID` `谱面难度` `谱面等级` `BPM` `物量` `时长` `所属服务器` `谱师` `点赞数` `谱面`<br>
    **其中，`BPM` `物量`将以遍历谱面内容获取。`时长`将以音频文件长度获取。**

### 官谱
指令: 官谱 `ID` `难度`<br>
指令: 官谱 `筛选条件` `难度`

    种类一
    `ID` 为必填参数。程序将利用用户输入的谱面ID向Bestdori Api查询相关Chart信息。
    `难度` 为可选参数。可用参数为: `ez` `nm` `hd` `ex` `sp`。默认值为: `ex`
    使用例: 官谱 1 sp

    种类二
    `筛选条件` 为必填参数。程序将向Bestdori Api查询所有歌曲信息，并利用用户输入的`条件`进行筛选。其中，可用条件为: `歌曲所属乐队` `歌曲种类` `谱面等级`。
    `难度` 为可选参数。可用参数为: `ez` `nm` `hd` `ex` `sp`。默认值为: `ex`
    使用例: 官谱 mygo 原创 lv29 sp
    >**注意`难度`参数不参与条件筛选。即`官谱 mygo 原创 lv29 ex`将产出ex谱数据。**

信息将包括: `谱面名称` `谱面ID` `谱面难度` `谱面等级` `BPM` `物量` `时长` `所属服务器` `所属乐队` `谱面`<br>
    **所有信息皆由Bestori提供**

### 查谱
指令: 查谱 `ID` `带音乐`<br>
指令: 查谱 `ID` `难度`<br>
指令: 查谱 `筛选条件` `难度`

    `自制谱`及`官谱`的整合接口，格式同上。查询将以自制谱为先，官谱为后。


### 随机查谱
指令: 随机查谱<br>

    无参数

将随机抽取`官谱`并进行查询。先随机`曲目`，后随机`难度`。


## 查卡
查卡功能支持快速向Bestdori查询卡面信息。具体信息及指令如下:

### 查卡
指令: 查卡 `ID`

    种类一
    `ID` 为必填参数。程序将利用用户输入的卡面ID向Bestdori Api查询相关Card信息。
    使用例: 查卡 947

信息将包括: `角色名称` `所处乐团` `卡片名称` `卡片ID` `星级` `属性` `等级上限` `技能` `数据` `卡面`<br>
    **所有信息皆由Bestori提供**

### 随机查卡
指令: 随机查卡

    无参数

将随机抽取`卡面ID`并进行查询。。

### 随机卡面
指令: 随机卡面

    无参数

将随机抽取`卡面ID`并取得卡面图片。先随机`卡面ID`，后随机`训练状态`。

## 查玩家
查玩家功能支持快速向Bestdori查询玩家信息。具体信息及指令如下:

### 查玩家
指令: 查玩家 `ID` `服务器`

    种类一
    `ID` 为必填参数。程序将利用用户输入的玩家ID向Bestdori Api查询相关Player信息。
    `服务器` 为可选参数。可用参数为: `jp` `en` `tw` `cn` `kr`。默认值为: `cn`
    使用例: 查玩家 1145141919810 jp

信息将包括: `用户名称` `用户等级` `用户ID` `账号简介` `综合力` `通关状况`<br>
    **所有信息皆由Bestori提供**

### 绑定
指令: 绑定 `ID` `服务器`

    种类一
    `ID` 为必填参数。程序将利用用户输入的玩家ID向Bestdori Api查询相关Player信息。
    `服务器` 为可选参数。可用参数为: `jp` `en` `tw` `cn` `kr`。默认值为: `cn`
    使用例: 绑定 1145141919810 jp

将玩家绑定信息储存至后台json文件，用于快速查询。允许多号绑定。

### 删除绑定
指令: 删除绑定 `绑定顺位`

    种类一
    `绑定顺位` 为可选参数。默认值为: `1`
    使用例: 删除绑定 1

从后台json文件删除已储存玩家绑定信息。

### 查绑定
指令: 查绑定

    无参数

从后台json文件查询已储存绑定信息。

### 玩家状态
指令: 玩家状态 `绑定顺位`

    种类一
    `绑定顺位` 为可选参数。默认值为: `1`
    使用例: 玩家状态 1

从后台json文件提取已储存玩家绑定信息，并使用`查玩家`查询玩家信息。

# YGO群赛
游戏王群赛, 以下简称YGO。<br>
YGO类功能为此机器人的副功能。主要目的是快速开启群赛，并公开匹配选手。<br>

具体功能仍于bate测试阶段，将不设使用方法详解。如需使用，请跳转[此链接](https://github.com/Sugar51243/BangDreamQQRobot/blob/main/bot/scr/command/ygo/data/help.txt "YGO群赛类帮助文档")查询。

# BiliBili视频获取
在收到`视频分享网址` `QQ快捷分享资料卡`时利用`nxvav.cn`查询BiliBili视频源并发送。

# 通用互动
通用互动类功能用于丰富机器人互动选单及娱乐性，于进群后首次收信信息时自动注册，具体可互动关键词将不设展示，可以直接于代码内查看。此处将仅列举其中偏功能性的指令:

### JPRP | 今日老婆
指令: jrlp<br>
指令: 今日老婆<br>
随机抽取群友并匹配为当天老婆。资料将于每日初次使用指令时进行更新。

### 随机数
指令: .rd `参数1`d`参数2` `判定线` `重复次数` 决定我`内容`

    种类一
    `参数1` 为必填参数。纯数字。随机数范围将为`参数1`-`参数2`，且包括`参数1` `参数2`
    `参数2` 为必填参数。纯数字。随机数范围将为`参数1`-`参数2`，且包括`参数1` `参数2`
    `判定线` 为可选参数。程序将检查`随机数结果`是否大于`判定线`
    `重复次数` 为可选参数。程序将抽取`重复次数`次数的随机数，并多次判定`判定线`
    `内容` 为可选参数。程序将检查指令是否包括`决定我`字样。如包括，将以 `判定成功次数`>`判定次数/2` 判定用户是否`内容`。
    使用例: .rd 1d100 50 4 决定我公开此项目

随机抽取随机数。

### 注册功能
指令: 注册功能 `功能ID`<br>
指令: 功能注册 `功能ID`

    种类一&二
    `功能ID` 为必填参数。目前可选参数为: `bangdream` `ygo` `bilibili`
    使用例: 注册功能 bangdream
    使用例: 功能注册 1

随机抽取随机数。

# 部署
本程序依赖 `NcatBot` `PIL` `httpx` `eyed3` `bestdori-api` `bestdori-render` 运行，请自行依次于环境补完运行库。<br>
[NcatBot](https://github.com/liyihao1110/NcatBot)<br>
[PIL](https://github.com/python-pillow/Pillow)<br>
[httpx](https://github.com/encode/httpx)<br>
[eyed3](https://github.com/nicfit/eyeD3)<br>
[bestdori-api](https://github.com/WindowsSov8forUs/bestdori-api)<br>
[bestdori-render](https://github.com/zhaomaoniu/bestdori-render)<br>
[nodejs](https://nodejs.org/)<br>

    pip install ncatbot pillow httpx eyed3 bestdori-api bestdori-render setuptools aiohttp
    npm install http-server -g

main.py为程序主体，start-server.bat则用于公开机器人储存路径，用以提取音频URL。<br>
启动机器人需要于补全运行库后运行main.py，并手动启动start-server.bat。<br>

    start start-server.bat
    python main.py
    pause